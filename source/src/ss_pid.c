#include "ss_include.h"




//#pragma CODE_SECTION( pi_calc, "ramfuncs");








/**
 **********************************************************
 * @é‘èŠ¥æšŸé”›æ­·oid PI_DeInit( PI_TypeDef *p)
 * @éŽ»å¿šå ªé”›æ­…Iéç‰ˆåµæ¾¶å¶„ç¶…
 * @æˆæ’³å†é”›ï¿?pé”›æ°¬ç•¾æ¶”å¤Œæ®‘PIéç‰ˆï¿?
 * @æ©æ–¿æ´–é”›æ°­æ£¤
 * @æµ£æ»†ï¿½å’ƒï¿?
 * @é—å Ÿæ¹°é”›ï¿?
 **********************************************************
 */
void pi_reset( PI_STRUCT *p)
{
    p->a0           = 0;
    p->a1           = 0;

    p->Ek_0         = 0;     //  Error[k-0]
    p->Ek_1         = 0;     //  Error[k-1]

    p->T            = 0;
    p->Kp           = 0;
    p->Ti           = 0;

    p->Inc          = 0;
    p->Output       = 0;

    p->OutMax       = 0;
    p->OutMin       = 0;
}
/**
 **********************************************************
 * @º¯Êý£ºvoid PI_init ( PI_TypeDef *p)
 * @ÃèÊö£ºPI²ÎÊý¼ÆËã
 * @ÊäÈë£º*p£º¶¨ÒåµÄPIÊý¾Ý
 * @·µ»Ø£ºÎÞ 

 **********************************************************
 */
void pi_init ( PI_STRUCT *p)
{   
    p->Ti       = p->Ti <= 0 ? 10e6 : p->Ti;
    p->a0       = p->Kp * (1.0f + (float32)p->T / p->Ti);
    p->a1       = p->Kp;
}

/**
 **********************************************************
 * @é‘èŠ¥æšŸé”›æ­…I_float32 PI_Calc( PI_TypeDef *p)
 * @éŽ»å¿šå ªé”›æ­…Iæ¾§ç‚ºå™ºå¯®å¿•ç²¨ç» ï¿½
 * @æˆæ’³å†é”›ï¿?pé”›æ­…Iç¼æ’´ç€¯æµ£ï¿?
 * @æ©æ–¿æ´–é”›æ°­æ£¤
 * @æµ£æ»†ï¿½å’ƒï¿?
 * @é—å Ÿæ¹°é”›ï¿?
 **********************************************************
 */
void pi_calc( PI_STRUCT *p)
{
   

    p->Ek_0     = p->Ref - p->Fdb;  //


    p->Inc = (p->a0*p->Ek_0) -  (p->a1*p->Ek_1) ;//

    p->Output  += p->Inc;

    if(p->Output > p->OutMax)p->Output  = p->OutMax;
    if(p->Output < p->OutMin)p->Output  = p->OutMin;

    p->Ek_1 = p->Ek_0;
	
}

/**
 **********************************************************
 * @é‘èŠ¥æšŸé”›æ­·oid PI_Clean( PI_TypeDef *p)
 * @éŽ»å¿šå ªé”›æ°­ç«»å¦¤æ­…Iç’ï¼„ç•»æ¶“î… æ®‘ç¼‚æ’³ï¿?
 * @æˆæ’³å†é”›ï¿?pé”›æ°¬ç•¾æ¶”å¤Œæ®‘PIéç‰ˆï¿?
 * @æ©æ–¿æ´–é”›æ°­æ£¤
 * @æµ£æ»†ï¿½å’ƒï¿?
 * @é—å Ÿæ¹°é”›ï¿?
 **********************************************************
 */
void pi_clc( PI_STRUCT *p)
{
    p->Ek_0         = 0;     //  Error[k]
    p->Ek_1         = 0;     //  Error[k-1]
    p->Inc          = 0;
    p->Output       = 0;
}









